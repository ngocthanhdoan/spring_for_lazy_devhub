<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Management</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h1>Customer Management</h1>

<!-- Form for creating or updating an entity -->
<form id="customerForm" style="display: none;">
    <label for="id">id</label>
        <input type="text" id="id" name="id" />
    <label for="name">name</label>
        <input type="text" id="name" name="name" />
    <label for="orders">orders</label>
        <select id="orders" name="orders">
            <option value="">--Select--</option>
            <!-- Populate relationship options dynamically -->
        </select>
    <button type="submit">Submit</button>
    <input type="hidden" id="entityId" name="entityId" />
</form>

<!-- Table for displaying the list of entities -->
<table id="customerTable">
    <thead>
        <tr>
            <th>id</th>
            <th>name</th>
            <th>orders</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be populated here -->
    </tbody>
</table>

<script>
$(document).ready(function() {
    // Load all entities
    loadEntities();

    // Submit form for Create or Update
    $('#customerForm').on('submit', function(e) {
        e.preventDefault();
        var entityId = $('#entityId').val();
        var url = entityId ? '/api/customers/' + entityId : '/api/customers';
        var type = entityId ? 'PUT' : 'POST';

        $.ajax({
            url: url,
            type: type,
            data: $(this).serialize(),
            success: function(response) {
                alert('Saved successfully!');
                loadEntities();
                clearForm();
            },
            error: function(xhr, status, error) {
                alert('Error: ' + xhr.responseText);
            }
        });
    });

    // Load all entities into the table
    function loadEntities() {
        $.ajax({
            url: '/api/customers',
            type: 'GET',
            success: function(data) {
                var tableBody = $('#customerTable tbody');
                tableBody.empty(); // Clear existing data
                data.forEach(function(entity) {
                    var row = '<tr>';
                    row += '<td>' + entity.id + '</td>';
                    row += '<td>' + entity.name + '</td>';
                    row += '<td>' + entity.orders + '</td>';
                    row += '<td>' +
                        '<button class="edit" data-id="' + entity.id + '">Edit</button>' +
                        '<button class="delete" data-id="' + entity.id + '">Delete</button>' +
                        '</td>' +
                        '</tr>';
                    tableBody.append(row);
                });

                // Attach click event for edit and delete buttons
                $('.edit').on('click', function() {
                    var id = $(this).data('id');
                    editEntity(id);
                });

                $('.delete').on('click', function() {
                    var id = $(this).data('id');
                    deleteEntity(id);
                });
            },
            error: function(xhr, status, error) {
                alert('Error loading entities: ' + xhr.responseText);
            }
        });
    }

    // Edit entity
    function editEntity(id) {
        $.ajax({
            url: '/api/customers/' + id,
            type: 'GET',
            success: function(entity) {
                $('#entityId').val(entity.id);
                $('#id').val(entity.id);
                $('#name').val(entity.name);
                $('#orders').val(entity.orders);
                $('#customerForm').show();
            },
            error: function(xhr, status, error) {
                alert('Error fetching entity: ' + xhr.responseText);
            }
        });
    }

    // Delete entity
    function deleteEntity(id) {
        if (confirm('Are you sure you want to delete this item?')) {
            $.ajax({
                url: '/api/customers/' + id,
                type: 'DELETE',
                success: function() {
                    alert('Deleted successfully!');
                    loadEntities();
                },
                error: function(xhr, status, error) {
                    alert('Error deleting entity: ' + xhr.responseText);
                }
            });
        }
    }

    // Clear form
    function clearForm() {
        $('#customerForm')[0].reset();
        $('#entityId').val('');
        $('#customerForm').hide();
    }
});
</script>

</body>
</html>
